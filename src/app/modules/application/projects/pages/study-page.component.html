<div id="study-page">
  <!-- <div class="border-head">
        <h3>
            <a href="index.html" class="logo" style="color: black;"><b>P<span>L</span>ant
                    exper<span>I</span>me<span>N</span>tal
                    meta<span>D</span>at<span>A</span></b></a>
        </h3>           
            <button class="btn btn-success" style="float: right;" type="submit" (click)="submit();" [disabled]="">Save Project</button>
    </div> -->
  <button class="btn btn-danger" style="float: right;" type="submit" (click)="close();" [disabled]="">Close
    Study</button>
  <div>
  <!-- Nav pills -->
  <!-- Nav pills -->
  <!-- Nav pills -->
  <ul class="nav nav-pills">
    <li class="nav-item">
      <a class="nav-link active" [ngClass]="{ 'active':activeTab==='studyinfo'}" (click)="changeTab('studyinfo')"
        aria-controls="studyinfo" role="tab" data-toggle="tab" href="#studyinfo">1. Study informations</a>
    </li>
    <li class="nav-item">
      <a class="nav-link active" [ngClass]="{ 'active':activeTab==='studysite'}" (click)="changeTab('studysite')"
        aria-controls="studydesign" role="tab" data-toggle="tab" href="#studysite">2. Experimental site</a>
    </li>
    <li class="nav-item">
      <a class="nav-link active" [ngClass]="{ 'active':activeTab==='studydesign'}" (click)="changeTab('studydesign')"
        aria-controls="studydesign" role="tab" data-toggle="tab" href="#studydesign">3. Experimental design</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" [ngClass]="{ 'active':activeTab==='biomat'}" (click)="changeTab('biomat')" href="#biomat"
        aria-controls="biomat" role="tab" data-toggle="tab">4. Biological materials</a>
    </li>
    <!-- <li class="nav-item">
      <a class="nav-link" [ngClass]="{ 'active':activeTab==='obs'}" (click)="changeTab('obs')" href="#obs"
        aria-controls="obs" role="tab" data-toggle="tab">5. Observations</a>
    </li> -->
    <li class="nav-item">
      <a class="nav-link" [ngClass]="{ 'active':activeTab==='obsvar'}" (click)="changeTab('obsvar')" href="#obsvar"
        aria-controls="obsvar" role="tab" data-toggle="tab">6. Observed variables</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" [ngClass]="{ 'active':activeTab==='expfac'}" (click)="changeTab('expfac')" href="#expfac"
        aria-controls="expfac" role="tab" data-toggle="tab">7. Experimental Factors</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" [ngClass]="{ 'active':activeTab==='env'}" (click)="changeTab('env')" href="#env"
        aria-controls="env" role="tab" data-toggle="tab">8. Environmental parameters</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" [ngClass]="{ 'active':activeTab==='events'}" (click)="changeTab('events')" href="#events"
        aria-controls="events" role="tab" data-toggle="tab">9. Events</a>
    </li>
    <!-- <li class="nav-item">
      <a class="nav-link" [ngClass]="{ 'active':activeTab==='data_files'}" (click)="changeTab('data_files')" href="#data_files"
        aria-controls="expfac" role="tab" data-toggle="tab">9. Data files</a>
    </li> -->
    <li class="nav-item">
      <a class="nav-link" [ngClass]="{ 'active':activeTab==='People'}" href="#People" 
      (click)="changeTab('People')" aria-controls="People" role="tab" data-toggle="tab">9. Study members</a>
  </li>
  </ul>

  <!-- Tab panes -->
  <!-- Tab panes -->
  <!-- Tab panes -->
  <div class="tab-content">
    <div [ngClass]="{ 'active':activeTab==='studyinfo'}" role="tabpanel" class="tab-pane active" id="studyinfo">
      <h3>Describe your study</h3>
      <p>Here you can easily create experimental design structure that will hold all of your obsservation units, biological materials and 
        allows user to easily extract sampless and observations at any level define in Study form </p>
      <mat-card style="width: 98%;">
        <!-- <app-form *ngIf="activeTab==='studyinfo'" 
          id="study_form" 
          (notify)="get_output_from_child($event)"
          [model_type]="'study'" 
          [level]="1" 
          [parent_id]="get_parent_id" 
          [model_key]="get_model_key" 
          [mode]="get_mode"
          inline="true" 
          onlyTemplate="false" 
          asTemplate="false" 
          [role]="get_role">
        </app-form> -->

        <app-study-form *ngIf="activeTab==='studyinfo'" 
          id="study_form" 
          (notify)="get_output_from_child($event)"
          [model_type]="'study'" 
          [level]="1" 
          [parent_id]="get_parent_id" 
          [model_key]="get_model_key" 
          [mode]="get_mode"
          inline="true" 
          onlyTemplate="false" 
          asTemplate="false" 
          [role]="get_role">
        </app-study-form>        
      </mat-card>
    </div>

    <div [ngClass]="{ 'active':activeTab==='studysite'}" role="tabpanel" class="tab-pane active" id="studysite">
        <!-- <app-form *ngIf="activeTab==='studysite'" id="study_site" (notify)="get_output_from_child($event)"
          [model_type]="'study'" [level]="2" [parent_id]="get_parent_id" [model_key]="get_model_key" [mode]="get_mode"
          inline="true" onlyTemplate="false" asTemplate="false" [role]="get_role">
        </app-form>  -->
        <app-study-form 
          *ngIf="activeTab==='studysite'" 
          id="study_site" 
          (notify)="get_output_from_child($event)"
          [model_type]="'study'" 
          [level]="2" 
          [parent_id]="get_parent_id" 
          [model_key]="get_model_key" 
          [mode]="get_mode"
          inline="true" 
          onlyTemplate="false" 
          asTemplate="false" 
          [role]="get_role"
        >
        </app-study-form> 
        
    </div>
    <div [ngClass]="{ 'active':activeTab==='studydesign'}" role="tabpanel" class="tab-pane active" id="studydesign">
      <h3>Experimental design</h3>
      <mat-card style="width: 98%;">
        <p><b>Definition:</b> An experimental design is a set of rules by which treatments are assigned to the experimentals units, 
          (i.e. the piece of experimental material to which one trial of a single treatment is applied).</p>
        <div *ngIf="get_role!=='owner'">
          <p>You do not have access to this part of the project. Please contact project owner to gain full project access </p>
        </div>
        <div *ngIf="get_role==='owner'">
          <h3>Describe your experimental design</h3>
          <mat-accordion>
                    <mat-expansion-panel [disabled]="panel_disabled" [expanded]="panel_expanded"  (opened)="panelOpenState = true" (closed)="panelOpenState = false">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                            General description
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <app-study-form 
                        id="study_form_design" 
                        (notify)="get_output_from_child($event)" 
                        [level]="3" 
                        [model_type]="'study'" 
                        [model_key]="get_model_key" 
                        [parent_id]="get_parent_id" 
                        [mode]="'edit'"  
                        [role]="get_role"
                        onlyTemplate="false"
                        inline="true"
                        >
                        </app-study-form>
                    </mat-expansion-panel>
          </mat-accordion>
          <mat-divider></mat-divider>
          <br>
          
          <app-experimental-designs-page 
            *ngIf="activeTab==='studydesign'" 
            id="study_design" 
            (notify)="get_output_from_child($event)" 
            [level]="3" 
            [model_key]="get_model_key" 
            [model_type]="'experimental_design'"
            [parent_id]="get_model_id" 
            [grand_parent_id]="get_parent_id" 
            [mode]="get_mode" 
            [role]="get_role"
            [group_key]="get_group_key"
          >
          </app-experimental-designs-page>
          <!-- <app-observations-page 
            *ngIf="activeTab==='studydesign'" 
            (notify)="get_output_from_child($event)"
            [level]="1" 
            [model_key]="get_model_key" 
            [model_type]="'observation_unit'"
            [parent_id]="get_model_id" 
            [grand_parent_id]="get_parent_id" 
            [mode]="get_mode" 
            [role]="get_role"
            [group_key]="get_group_key"
            >
           </app-observations-page>  -->    
        </div>

      </mat-card>
    </div>

    <div [ngClass]="{ 'active':activeTab==='biomat'}" role="tabpanel" class="tab-pane" id="biomat">
      <h3>Biological materials</h3>
      <mat-card style="width: 98%;">
        <p><b>Definition:</b> The biological material being studied (e.g. plants grown from a certain bag or seed, or plants grown in a particular field). The original source of that material (e.g., the seeds or the original plant cloned) is called the material source, which, when held by a material repository, should have its stock identified.</p>

        <div *ngIf="get_role!=='owner'">
          <p>You do not have access to this part of the project. Please contact project owner to gain full project access </p>
        </div>
        <div *ngIf="get_role==='owner'">
          <app-biological-material-page 
          *ngIf="activeTab==='biomat'" 
          (notify)="get_output_from_child($event)"
          [level]="1" 
          [model_key]="" 
          [model_type]="'biological_material'" 
          [grand_parent_id]="get_parent_id"  
          [parent_id]="get_model_id" 
          [mode]="get_mode" 
          [role]="get_role"
          [group_key]="get_group_key"
          >
        </app-biological-material-page>
       </div>
        
      </mat-card>
    </div>
   <!--  <div [ngClass]="{ 'active':activeTab==='obs'}" role="tabpanel" class="tab-pane" id="obs">
      <h3>Describe observation units</h3>
      <mat-card style="width: 98%;">
        <div *ngIf="get_role!=='owner'">
          <p>You do not have access to this part of the project. Please contact project owner to gain full project access </p>
        </div>
        <div *ngIf="get_role==='owner'">
          <app-observations-page 
            *ngIf="activeTab==='obs'" 
            (notify)="get_output_from_child($event)"
            [level]="1" 
            [model_key]="get_model_key" 
            [model_type]="'observation_unit'"
            [parent_id]="get_model_id" 
            [grand_parent_id]="get_parent_id" 
            [mode]="get_mode" 
            [role]="get_role"
            [group_key]="get_group_key">
           </app-observations-page>
       </div>
      </mat-card>
    </div> -->

    <div [ngClass]="{ 'active':activeTab==='obsvar'}" role="tabpanel" class="tab-pane" id="obsvar">
      <h3>Observed variables</h3>
      <mat-card style="width: 98%;">
        <p><b>Definition:</b> An observed variable describes how a measurement has been made. It typically takes the form of a measured characteristic of the observation unit (plant or environmental trait), associated to the method and unit of measurement.</p>

        <div *ngIf="get_role!=='owner'">
          <p>You do not have access to this part of the project. Please contact project owner to gain full project access </p>
        </div>
        <div *ngIf="get_role==='owner'">
          <!-- <app-observed-variable-page *ngIf="activeTab==='obsvar'" (notify)="get_output_from_child($event)"
          [model_type]="'observed_variable'" [level]="1" [parent_id]="get_model_id" [model_key]="" [mode]="get_mode">
        </app-observed-variable-page> -->
        
          <app-observed-variables-page 
          (notify)="get_output_from_child($event)" 
          [grand_parent_id]="get_parent_id" 
          [model_type]="'observed_variable'" 
          [level]="1" 
          [parent_id]="get_model_id" 
          [model_key]="" 
          [mode]="get_mode" 
          [role]="get_role" 
          [group_key]="get_group_key">
        </app-observed-variables-page>
       </div>       
      </mat-card>
    </div>
    <div [ngClass]="{ 'active':activeTab==='expfac'}" role="tabpanel" class="tab-pane" id="expfac">
      <h3>Experimental factors</h3>
      <mat-card style="width: 98%;">
        <p><b>Definition:</b> The object of a study is to ascertain the impact of one or more factors on the biological material. Thus, a factor is, by definition a condition that varies between observation units, which may be biotic (pest, disease interaction) or abiotic (treatment and cultural practice) in nature. Depending on the level of the data, an experimental factor can be either  'what is the factor applied to the plant' (i.e. Unwatered), or the 'environmental characterisation' (i.e. if no rain on unwatered plant : Drought ;  if rain on unwatered plant: Irrigated) </p>

        <div *ngIf="get_role!=='owner'">
          <p>You do not have access to this part of the project. Please contact project owner to gain full project access </p>
        </div>
        <div *ngIf="get_role==='owner'">
          <app-experimental-factors-page 
            *ngIf="activeTab==='expfac'" 
            (notify)="get_output_from_child($event)"
            [level]="1" 
            [parent_id]="get_model_id" 
            [model_key]="" 
            [model_type]="'experimental_factor'"
            [mode]="get_mode" 
            [role]="get_role"
            [grand_parent_id]="get_parent_id" 
            [group_key]="get_group_key"
            >
        </app-experimental-factors-page>
       </div>
      </mat-card>
    </div>
    <div [ngClass]="{ 'active':activeTab==='env'}" role="tabpanel" class="tab-pane" id="env">
      <h3>Describe environmental parameters</h3>
      <mat-card style="width: 98%;">
        <p><b>Definition:</b>
          Environmental parameters that were kept constant throughout the study and did not change between observation units or assays. 
          Environment characteristics that vary over time, i.e. environmental variables, should be recorded as Observed Variables.
        </p>

        <div *ngIf="get_role!=='owner'">
          <p>You do not have access to this part of the project. Please contact project owner to gain full project access </p>
        </div>
        <div *ngIf="get_role==='owner'">
          <app-environment-variables-page 
            *ngIf="activeTab==='env'" 
            (notify)="get_output_from_child($event)" 
            [model_type]="'environment'" 
            [level]="1" 
            [grand_parent_id]="get_parent_id" 
            [parent_id]="get_model_id" 
            [model_key]="" 
            [mode]="get_mode" 
            [role]="get_role" 
            [group_key]="get_group_key" 
          >
        </app-environment-variables-page>
       </div>
      </mat-card>
    </div>

    <div [ngClass]="{ 'active':activeTab==='events'}" role="tabpanel" class="tab-pane" id="events">
      <h3>Events</h3>
      <mat-card style="width: 98%;">
        <p>
          <b>Definition:</b> An event is discrete occurrence at a particular time in the experiment (which can be natural, 
          such as rain, or unnatural, such as planting, watering, etc). Events may be the realization of Factors or parts of 
          Factors, or may be confounding to Factors. Can be applied at the whole study level or to only a subset of observation
           units.
        </p>
        <div *ngIf="get_role!=='owner'">
          <p>You do not have access to this part of the project. Please contact project owner to gain full project access </p>
        </div>
        <div *ngIf="get_role==='owner'">
          <app-events-page 
            *ngIf="activeTab==='events'" 
            (notify)="get_output_from_child($event)" 
            [model_type]="'event'" 
            [level]="1" 
            [grand_parent_id]="get_parent_id" 
            [parent_id]="get_model_id" 
            [model_key]="" 
            [mode]="get_mode" 
            [role]="get_role"  
            [group_key]="get_group_key" 
        >
        </app-events-page>
       </div>
      </mat-card>
    </div>
    <!--<div [ngClass]="{ 'active':activeTab==='data_files'}" role="tabpanel" class="tab-pane" id="data_files">
      <h3>Explore associated datafiles</h3>
      <mat-card style="width: 98%;">
        <div *ngIf="get_role!=='owner'">
          <p>You do not have access to this part of the project. Please contact project owner to gain full project access </p>
        </div>
        <div *ngIf="get_role==='owner'">
          <app-data-files-page 
            *ngIf="activeTab==='data_files'" 
            (notify)="get_output_from_child($event)"
            collection="studies" 
            [parent_id]="get_model_id" 
            [model_key]="get_model_key"
            [role]="get_role" 
            [group_key]="get_group_key"
          >
          </app-data-files-page>
       </div>
      <table  class="table table-hover table-bordered  table-striped text-center">
          <tbody>
            <tr *ngFor="let key of get_data() ; index as j;">

              <td *ngIf="key != 'headers'" style="font-size:14px;text-align: center; " scope="row">
                {{key}}
              </td>

              <td *ngIf="key.includes('file link')" style="font-size:14px;text-align: center; color: blue; " scope="row">
                <a href="{{get_current_data_object(node)[key]}}" target="_blank">{{get_current_data_object(node)[key]}}</a>
              </td>

              <td *ngIf="key.includes('file version') || key.includes('file description')"
                style="font-size:14px;text-align: center;" scope="row">
                {{get_current_data_object(node)[key]}}
              </td>
              <td *ngIf="key === 'Data'" style="font-size:14px;text-align: center;" scope="row">
                <button (click)="show_datatable(node)" class="btn btn-primary btn-xs" title="{{node.id}}">Show
                  data
                </button>
              </td>
              <td *ngIf="key === 'associated_headers'" style="font-size:14px;text-align: center;" scope="row">
                <div class="btn-group mr-3" *ngFor="let headers of get_current_data_file_headers(node) ; index as k;">
                  <div *ngIf="headers['associated_linda_id'] === ''" class="btn-group" role="group"
                    aria-label="Button group with nested dropdown">
                    <button style="float: left;" [ngStyle]="getIconStyle(headers['associated_component'])"
                      class="btn btn-primary btn-xs"
                      title="{{headers['header']}}:{{headers['associated_linda_id']}}">{{headers['associated_component']}}
                    </button>
                  </div>
                  <div *ngIf="headers['associated_linda_id'] !== ''" class="btn-group" role="group"
                    aria-label="Button group with nested dropdown">
                    <button style="float: left;" [ngStyle]="getIconStyle(headers['associated_component'])"
                      class="btn btn-primary btn-xs"
                      title="{{headers['header']}}:{{headers['associated_linda_id']}}">{{headers['associated_component']}}
                    </button>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table> 
      </mat-card>
    </div>-->
    <div [ngClass]="{ 'active':activeTab==='People'}"  role="tabpanel" class="tab-pane" id="People">
      <h3>Project members</h3>
      <!-- add filter in gantt as in redmine -->
          <app-persons-page  *ngIf="activeTab==='People'"  [model_id]="get_model_id"></app-persons-page>
    </div>
  </div>
</div>
</div>