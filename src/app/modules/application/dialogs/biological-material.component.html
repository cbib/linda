<div class="border-head">
    <nav class="navbar navbar-expand-sm navbar-dark">
        <h3>
            <a href="index.html" class="logo"><b>P<span>L</span>ant exper<span>I</span>me<span>N</span>tal
                    meta<span>D</span>at<span>A</span></b></a>
        </h3>
    </nav>
</div>
<h1 mat-dialog-title>Biological Material Description</h1>

<div mat-dialog-content>
    <mat-accordion>
        <mat-expansion-panel [disabled]="false" [expanded]="true" (opened)="panelOpenState = true"
            (closed)="panelOpenState = false">
            <mat-expansion-panel-header>
                <mat-panel-title>
                    Global configuration options
                </mat-panel-title>
            </mat-expansion-panel-header>
            <form [formGroup]="get_taxonScientificNameForm">
                <mat-form-field appearance="outline">
                    <mat-label>Taxon Scientific Name</mat-label>
                    <input matInput placeholder="Taxon Scientific Name" (keypress)="searchTaxonScientificNameStart($event)" (keydown)="onAddScientificNames($event)" (blur)="onBlurMethod()" formControlName="keyTaxonScientificNames" name="keyTaxonScientificNames" list="dynamicspecies">
                    <datalist id="dynamicspecies">
                        <option *ngFor="let node of get_selected_species()" [value]="node.species" [ngValue]="node.species">
                            {{node.species}}</option>
                    </datalist>
                </mat-form-field>
                <div class="chip-list">
                    <chip-list (notify)="get_output_from_taxonScientificNameForm($event)" [skills]="taxonScientificNames"></chip-list>
                </div>
            </form>
            <!-- <h4>Taxon Scientific Name</h4>
            <input [(ngModel)]="TaxonScientificName" mdbInput placeholder="" type="text" class="form-control"
                (keypress)="searchStart($event)" (onchange)="onspeciesChanged($event)" list="dynamicspecies" />
            <datalist id="dynamicspecies">
                <option *ngFor="let node of get_selected_species()" [value]="node.species" [ngValue]="node.species">
                    {{node.species}}</option>
            </datalist> -->

            <h4>Holding institution</h4>
            <input [(ngModel)]="Institution" mdbInput placeholder="" type="text" class="form-control"
                (keyup)="onInstitutionChanged($event)" (onchange)="onInstitutionChanged($event)" list="dynamicinstitution" />
            <datalist id="dynamicinstitution">
                <option *ngFor="let node of get_selected_institutions()" [value]="node.species"
                    [ngValue]="node.species">{{node.species}}</option>
            </datalist>

            <div *ngFor="let ont of ['EO','EnvO'] ; index as o;" class="btn-group">
                <button class="btn btn-success btn-xs fa fa-plus"
                (click)="onGlobalOntologyTermSelection(ont, 'Biological Material Preprocessing', false)">
                    {{ont}}
                </button>
            </div>
            <form [formGroup]="get_biologicalMaterialPreprocessingForm">
                <mat-form-field appearance="outline">
                    <mat-label>Biological Material Preprocessing</mat-label>
                <input 
                style="color:black" 
                matInput 
                formControlName="keyBiologicalMaterialPreprocessings" 
                name="keyTaxonScientificNames"
                (keydown)="onAddBiologicalMaterialPreprocessings($event)"
                (blur)="onBlurMethodBiologicalMaterialPreprocessing()"
                placeholder="EO:0007210 - PVY(NTN); transplanted from study http://phenome-fppn.fr/maugio/2013/t2351 observation unit ID: pot:894" 
                type="text" 
                (keypress)="onTaskAdd($event)" 
                />
                <div class="chip-list">
                    <chip-list (notify)="get_output_from_BiologicalMaterialPreprocessingForm($event)" [skills]="BiologicalMaterialPreprocessings"></chip-list>
                </div>
                </mat-form-field>
            </form>


            <h4>NCBI Taxon</h4>
            <input [(ngModel)]="Taxon" mdbInput placeholder="" type="text" class="form-control"
                (keyup)="onTaxonChanged($event)" (keypress)="searchTaxonStart($event)" list="dynamictaxons" />
            <datalist id="dynamictaxons">
                <option *ngFor="let node of get_selected_taxons()" [value]="node.taxon"
                    [ngValue]="node.taxon">{{node.taxon+ '-'+node.species}}</option>
            </datalist>

            <h4>biological material source identifier</h4>
            <p>
                <b>Definition:</b> An identifier for the source of the biological material, in the form of a key-value pair comprising 
                the name/identifier of the repository from which the material was sourced plus the accession number 
                of the repository for that material. Where an accession number has not been assigned, but the material 
                has been derived from the crossing of known accessions, the material can be defined as follows: 
                'mother_accession X father_accession', or, if father is unknown, as 'mother_accession X UNKNOWN'. 
                For in situ material, the region of provenance may be used when an accession is not available.
            </p>
            <textarea #myText2 [(ngModel)]="MaterialID" (paste)="onMaterialPaste($event)" (input)="onMaterialInput(myText2.value)"></textarea>
            <!-- <section class="example-section">
                <mat-radio-group [(ngModel)]="PasteMaterialIds" [ngModelOptions]="{standalone: true}">
                    <mat-radio-button class="example-margin" value="paste ids">Paste ids</mat-radio-button>
                </mat-radio-group>
            </section>
            <mat-card *ngIf="PasteMaterialIds==='paste ids'">
                <textarea #myText2 (paste)="onMaterialPaste($event)" (input)="onMaterialInput(myText2.value)"></textarea>
            </mat-card>
              <mat-card *ngIf="PasteMaterialIds===''">
                <input [(ngModel)]="MaterialID" mdbInput placeholder="" type="text"
                (keyup)="onMaterialIdChanged($event)" />
              </mat-card> -->
            

            <h4>biological material identifiers </h4>
            <p><b>Definition:</b>  Code used to identify the biological material in the data file. Should be unique within 
                the Investigation. Can correspond to experimental plant ID, seed lot ID, etc This material 
                identification is different from a BiosampleID which corresponds to Observation Unit or 
                Samples sections
            </p> 
                <p>
                    You can use your own Material ID by selecting <mat-radio-button class="example-margin" value="paste ids">Paste ids</mat-radio-button>
                    or simply let Linda create biological material identifier based on material source accession, plant
                    number and replicate number.
                </p>
                <div class="form-group">
                    <section class="example-section">
                        <mat-radio-group [(ngModel)]="labelPosition" [ngModelOptions]="{standalone: true}">
                            <mat-radio-button class="example-margin" value="autogenerate ids">Autogenerate ids
                            </mat-radio-button>
                            <mat-radio-button class="example-margin" value="paste ids">Paste ids</mat-radio-button>
                        </mat-radio-group>
                    </section>
                    <mat-card *ngIf="labelPosition==='autogenerate ids'">
                        <!-- <label for="obsunit">Select total number of observation units:</label>
                    <input id="obsunit" type="number">
                    <label for="prefix">Select prefix for ids:</label>
                    <input id="prefix" type="text"> -->
                        Select the number of plants by accession in your study ? <br>
                        <select [ngModel]="biological_material_n" name="select_num" size="1"
                            (change)="onNumChange($event.target.value)">
                            <option *ngFor="let n of numbers" [value]="n">{{n}}</option>
                        </select> <br>
                        Select the number of replicate by accession in your study ? <br>
                        <select [ngModel]="replication" name="select_num" size="1"
                            (change)="onRepChange($event.target.value)">
                            <option *ngFor="let n2 of numbers" [value]="n2">{{n2}}</option>
                        </select>
                    </mat-card>
                    <mat-card *ngIf="labelPosition!=='autogenerate ids'">
                        <!-- <mat-checkbox class="example-margin" [(ngModel)]="checked">Checked</mat-checkbox> -->
                        <textarea #myText (paste)="onBiologicalMaterialPaste($event)" (input)="onBiologicalMaterialInput(myText.value)"></textarea>
                    </mat-card>
                </div>
            
        </mat-expansion-panel>
        <div class="action-container">
            <button [disabled]="taxonScientificNames.length===0" class="btn btn-primary" mat-raised-button type="submit" (click)="save()">Add Biological
                materials</button>
        </div>
    </mat-accordion>
        

    <div *ngIf="mode==='from_data_file'">
        <p *ngIf="material_type==='Material ID'">
            You have defined the selected column as Material source ID in the data file called <b>{{data_filename}}</b>.
            <br>
            We have allready generated 1 biological material ID by default for each Material ID encountered.<br>
            Now but you probably want to add more than one biological material by Accession ID.
            Select the number of plant by accession in your study ? <br>
            <select [ngModel]="biological_material_n" name="select_num" size="1"
                (change)="onNumChange($event.target.value)">
                <option *ngFor="let number of numbers" [value]="number">{{number}}</option>
            </select>
        </p>
    </div>
    <!-- <div *ngIf="mode!=='from_data_file'">
        <p *ngIf="material_type=='Material ID'">
            You have material source <br>
            You probably want to add more than one biological material by Accession ID. <br>
            Select the number of plants by accession in your study ? <br>
            <select [ngModel]="biological_material_n" name="select_num" size="1"
                (change)="onNumChange($event.target.value)">
                <option *ngFor="let n of numbers" [value]="n">{{n}}</option>
            </select> <br>
            Select the number of replicate by accession in your study ? <br>
            <select [ngModel]="replication" name="select_num" size="1" (change)="onRepChange($event.target.value)">
                <option *ngFor="let n2 of numbers" [value]="n2">{{n2}}</option>
            </select>
        </p>
    </div> -->
</div>
<div mat-dialog-actions>
    <button mat-button (click)="onNoClick()">Cancel</button>
    <button mat-button (click)="onOkClick()">Ok</button>
</div>